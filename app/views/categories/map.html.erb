
<script type="application/json" id="bootstrapped-post-data">
	{"posts": <%= @posts.to_json.html_safe %>, "urls": <%= @urls.to_json.html_safe %>}
</script>

<script>
var postData = JSON.parse($('#bootstrapped-post-data').html())["posts"];
var urls = JSON.parse($('#bootstrapped-post-data').html())["urls"];
var geojson = [];


for (var i = 0; i < postData.length; i++) {
	var post = postData[i];
	var url = urls[i];
	
	if (post["latitude"] && post["longitude"]) {
		var coords = [post["longitude"], post["latitude"]];
		var titleString = "$" + post["rent"] + "/" + post["beds"] + " br in " + post["specific_location"];
	
		geojson.push({
	    "type": "Feature",
	    "geometry": {
	      "type": "Point",
	      "coordinates": coords
	    },
	    "properties": {
	      "title": titleString,
				"description": post["title"],
	      "marker-color": "#fc4353",
	      "marker-size": "small",
				url: url
	   	}
	 });
	}
}


$(function () {
	var map = L.mapbox.map('map', 'examples.map-9ijuk24y').setView([40.7, -74], 12);
  
	map.featureLayer.setGeoJSON(geojson);
	
	map.featureLayer.on('mouseover', function(e) {
	    e.layer.openPopup();
	});
	map.featureLayer.on('mouseout', function(e) {
	    e.layer.closePopup();
	});
	
	map.featureLayer.on('click', function(e) {
	    e.layer.unbindPopup();
	    window.open(e.layer.feature.properties.url);
	});
	
});
</script>